<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Catan Pro Mobile</title>
    <style>
        :root {
            --hex-w: 100px;
            --hex-h: 110px;
            --accent: #e67e22;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: #121212;
            color: white;
            margin: 0;
            display: flex;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 320px;
            background: #2c3e50;
            padding: 15px;
            z-index: 10;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex-shrink: 0;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .control-group {
            background: #34495e;
            padding: 10px;
            border-radius: 8px;
        }

        .group-title {
            display: block;
            font-size: 0.7em;
            color: #bdc3c7;
            margin-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* Input & Pfeile Steuerung */
        .stepper {
            display: flex;
            align-items: center;
            background: #1a252f;
            border-radius: 4px;
            overflow: hidden;
            height: 36px;
        }

        input[type="number"] {
            flex-grow: 1;
            width: 40px;
            border: none;
            background: transparent;
            color: white;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            -moz-appearance: textfield;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .spin-btn {
            background: var(--accent);
            color: white;
            border: none;
            width: 35px;
            height: 100%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .spin-btn:active {
            background: #d35400;
        }

        .spin-btn.down {
            border-right: 1px solid #2c3e50;
        }

        /* Ressourcen Liste */
        .res-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .res-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .res-label {
            font-size: 0.85em;
            flex-grow: 1;
        }

        /* Checkbox */
        .check-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #34495e;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .check-container input {
            width: 18px;
            height: 18px;
            margin: 0;
        }

        button.generate-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        /* VIEWPORT */
        .viewport {
            flex-grow: 1;
            background: radial-gradient(circle at center, #2980b9 0%, #1a252f 100%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #board-wrapper {
            position: absolute;
            transform-origin: center center;
        }

        #board {
            position: relative;
            width: 0;
            height: 0;
        }

        .hex {
            position: absolute;
            width: var(--hex-w);
            height: var(--hex-h);
            /* Oben/Unten 2% Puffer, Links/Rechts 5% Puffer für optischen Ausgleich */
            clip-path: polygon(50% 2%, 95% 25%, 95% 75%, 50% 98%, 5% 75%, 5% 25%);
            display: flex;
            justify-content: center;
            align-items: center;
            transform: translate(-50%, -50%);
        }

        .forest {
            background: #1b5e20;
        }

        .pasture {
            background: #76ff03;
        }

        .field {
            background: #f1c40f;
        }

        .hill {
            background: #d35400;
        }

        .mountain {
            background: #7f8c8d;
        }

        .desert {
            background: #f3e5ab;
        }

        .token {
            background: #fff;
            color: #333;
            border-radius: 50%;
            width: 34px;
            height: 34px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            border: 2px solid #333;
            font-size: 0.9em;
        }

        .red {
            color: #e74c3c;
            border-color: #e74c3c;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 48vh;
                order: 2;
                padding: 12px;
            }

            .viewport {
                height: 52vh;
                order: 1;
                flex-grow: 1;
            }

            h2 {
                display: none;
            }

            .res-list {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <h2 style="margin: 0; font-size: 1.2em; text-align: center;">Catan Setup</h2>

        <div class="control-group">
            <span class="group-title">Radius</span>
            <div class="stepper">
                <input type="number" id="radius" value="3" min="1" readonly>
                <button class="spin-btn down" onclick="step('radius', -1)">▼</button>
                <button class="spin-btn up" onclick="step('radius', 1)">▲</button>
            </div>
        </div>

        <label class="check-container">
            <input type="checkbox" id="randomTokens">
            <span>Zahlen & Buchstaben mischen</span>
        </label>

        <div class="control-group">
            <span class="group-title">Ressourcen</span>
            <div class="res-list" id="res-container">
            </div>
        </div>

        <button class="generate-btn" onclick="generate()">Neu generieren</button>
    </div>

    <div class="viewport">
        <div id="board-wrapper">
            <div id="board"></div>
        </div>
    </div>

    <script>
        const CATAN_SEQUENCE = [
            { l: 'A', n: 5 }, { l: 'B', n: 2 }, { l: 'C', n: 6 }, { l: 'D', n: 3 }, { l: 'E', n: 8 }, { l: 'F', n: 10 },
            { l: 'G', n: 9 }, { l: 'H', n: 12 }, { l: 'I', n: 11 }, { l: 'J', n: 4 }, { l: 'K', n: 8 }, { l: 'L', n: 10 },
            { l: 'M', n: 9 }, { l: 'N', n: 4 }, { l: 'O', n: 5 }, { l: 'P', n: 6 }, { l: 'Q', n: 3 }, { l: 'R', n: 11 }
        ];

        const RESOURCES = [
            { id: 'forest', n: 'Wald' }, { id: 'pasture', n: 'Weide' }, { id: 'field', n: 'Acker' },
            { id: 'hill', n: 'Hügel' }, { id: 'mountain', n: 'Erz' }, { id: 'desert', n: 'Wüste' }
        ];

        const resContainer = document.getElementById('res-container');
        RESOURCES.forEach(res => {
            const div = document.createElement('div');
            div.className = 'res-item';
            div.innerHTML = `
            <span class="res-label">${res.n}</span>
            <div class="stepper" style="width: 110px;">
                <input type="number" class="res-count" data-type="${res.id}" id="res-${res.id}" value="0" readonly>
                <button class="spin-btn down" onclick="step('res-${res.id}', -1)">▼</button>
                <button class="spin-btn up" onclick="step('res-${res.id}', 1)">▲</button>
            </div>
        `;
            resContainer.appendChild(div);
        });

        function step(id, amt) {
            const el = document.getElementById(id);
            el.value = Math.max(0, parseInt(el.value) + amt);
            if (id === 'radius') autoScaleResources();
        }

        function autoScaleResources() {
            const radius = parseInt(document.getElementById('radius').value) || 1;
            const totalHexes = 3 * radius * radius - 3 * radius + 1;
            let targetValues = {};

            if (radius === 3) {
                targetValues = { forest: 4, pasture: 4, field: 4, hill: 3, mountain: 3, desert: 1 };
            } else if (radius === 4) {
                targetValues = { forest: 8, pasture: 8, field: 8, hill: 6, mountain: 6, desert: 1 };
            } else {
                const baseRatio = { forest: 4, pasture: 4, field: 4, hill: 3, mountain: 3, desert: 1 };
                let remaining = totalHexes;
                RESOURCES.forEach(res => {
                    let count = Math.floor((baseRatio[res.id] / 19) * totalHexes);
                    targetValues[res.id] = count;
                    remaining -= count;
                });
                while (remaining > 0) {
                    const keys = Object.keys(baseRatio).filter(k => k !== 'desert');
                    targetValues[keys[Math.floor(Math.random() * keys.length)]]++;
                    remaining--;
                }
            }
            RESOURCES.forEach(res => {
                const el = document.getElementById('res-' + res.id);
                if (el) el.value = targetValues[res.id];
            });
        }

        function getSpiralCoords(radius) {
            let results = [];
            for (let r = 0; r < radius; r++) {
                if (r === 0) results.push({ q: 0, r: 0 });
                else {
                    let q = 0, s = -r;
                    const dirs = [[1, 0, -1], [0, 1, -1], [-1, 1, 0], [-1, 0, 1], [0, -1, 1], [1, -1, 0]];
                    for (let j = 0; j < 6; j++) {
                        for (let i = 0; i < r; i++) {
                            results.push({ q, r: s });
                            q += dirs[j][0]; s += dirs[j][1];
                        }
                    }
                }
            }
            return results;
        }

        function generate() {
            const board = document.getElementById('board');
            const wrapper = document.getElementById('board-wrapper');
            const viewport = document.querySelector('.viewport');
            board.innerHTML = '';

            const radius = parseInt(document.getElementById('radius').value) || 3;
            const randomMode = document.getElementById('randomTokens').checked;

            let resPool = [];
            document.querySelectorAll('.res-count').forEach(i => {
                for (let c = 0; c < parseInt(i.value); c++) resPool.push(i.dataset.type);
            });
            resPool.sort(() => Math.random() - 0.5);

            let coords = getSpiralCoords(radius);
            let tokenPool = [];
            const neededTokens = resPool.filter(r => r !== 'desert').length;
            for (let i = 0; i < neededTokens; i++) tokenPool.push(CATAN_SEQUENCE[i % CATAN_SEQUENCE.length]);
            if (randomMode) tokenPool.sort(() => Math.random() - 0.5);

            const hexW = 100; const hexH = 88;
            let tokenIndex = 0;

            coords.forEach((pos, i) => {
                if (i >= resPool.length) return;
                const type = resPool[i];
                const hex = document.createElement('div');
                hex.className = `hex ${type}`;
                hex.style.left = `${hexW * (pos.q + pos.r / 2)}px`;
                hex.style.top = `${hexH * pos.r}px`;

                if (type !== 'desert' && tokenIndex < tokenPool.length) {
                    const data = tokenPool[tokenIndex];
                    const tk = document.createElement('div');
                    tk.className = `token ${data.n === 6 || data.n === 8 ? 'red' : ''}`;
                    tk.innerHTML = `<span style="font-size:0.55em; color:#999; margin-bottom:-2px">${randomMode ? '' : data.l}</span><span>${data.n}</span>`;
                    hex.appendChild(tk);
                    tokenIndex++;
                }
                board.appendChild(hex);
            });

            const boardSize = (radius * 2 - 1);
            const scaleX = (viewport.clientWidth - 40) / (boardSize * hexW);
            const scaleY = (viewport.clientHeight - 40) / (boardSize * hexH);
            wrapper.style.transform = `scale(${Math.min(scaleX, scaleY, 2.5)})`;
        }

        window.addEventListener('resize', generate);
        autoScaleResources();
        generate();
    </script>
</body>

</html>
